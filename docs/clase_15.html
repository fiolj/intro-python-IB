<!DOCTYPE html>
<html class="writer-html5" lang="es" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Clase 15: Interfaces con otros lenguajes &mdash; documentaci√≥n de Clases de Python - </title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/rtd_overrides.css" type="text/css" />
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/translations.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="search" title="B√∫squeda" href="search.html" />
    <link rel="next" title="Ejercicios" href="ejercicios.html" />
    <link rel="prev" title="Clase 14: Animaciones e interactividad" href="clase_14.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Clases de Python
            <img src="_static/logo.svg" class="logo" alt="Logotipo"/>
          </a>
              <div class="version">
                IB - 2023
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Buscar documentos" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Dictado de las clases</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="clase_00.html">Clase 0: Introducci√≥n al lenguaje Python orientado a Ingenier√≠as y F√≠sica</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_01.html">Clase 1: Introducci√≥n al lenguaje</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_02.html">Clase 2: Tipos de datos y control</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_03.html">Clase 3: Tipos complejos y control de flujo</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_04.html">Clase 4: Funciones</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_05.html">Clase 5: Entrada y salida, decoradores, y errores</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_06.html">Clase 6: Programaci√≥n Orientada a Objetos</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_07.html">Clase 7: Control de versiones y biblioteca standard</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_08.html">Clase 8: Introducci√≥n a Numpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_09.html">Clase 9: Visualizaci√≥n</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_10.html">Clase 10: M√°s informaci√≥n sobre <strong>Numpy</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_11.html">Clase 11: Introducci√≥n al paquete Scipy</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_12.html">L√≠neas, s√≠mbolos y colores</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_12.html#nombres-de-ejes-y-leyendas">Nombres de ejes y leyendas</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_12.html#dos-graficos-en-la-misma-figura">Dos gr√°ficos en la misma figura</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_12.html#exportar-las-figuras">Exportar las figuras</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_12.html#graficos-en-coordenadas-polares">Gr√°ficos en coordenadas polares</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_12.html#otros-graficos">Otros gr√°ficos</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_12.html#histogramas">Histogramas</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_12.html#ejercicio-tasa-de-natalidad-en-argentina">Ejercicio: Tasa de natalidad en Argentina</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_12.html#histogramas-en-2d">Histogramas en 2D</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_12.html#graficos-de-contornos">Gr√°ficos de contornos</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_12.html#superficies-y-contornos">Superficies y contornos</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_13.html">Clase 13: Interpolaci√≥n y ajuste de curvas (fiteo)</a></li>
<li class="toctree-l1"><a class="reference internal" href="clase_14.html">Clase 14: Animaciones e interactividad</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Clase 15: Interfaces con otros lenguajes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ejemplo-1-rotacion-de-vectores">Ejemplo 1: Rotaci√≥n de vectores</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#importando-desde-un-modulo-en-un-archivo">Importando desde un m√≥dulo en un archivo</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interfaces-con-fortran">Interfaces con Fortran</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#primer-ejemplo-nuestro-codigo">Primer ejemplo: Nuestro c√≥digo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#f2py">F2PY</a></li>
<li class="toctree-l3"><a class="reference internal" href="#segundo-ejemplo-codigo-heredado">Segundo Ejemplo: C√≥digo heredado</a></li>
<li class="toctree-l3"><a class="reference internal" href="#f2py-para-codigo-en-c">F2PY para c√≥digo en C</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interfaces-con-otros-lenguajes-c">Interfaces con otros lenguajes: C</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Primer ejemplo: Nuestro c√≥digo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ctypes">CTypes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interfaces-con-clases-en-c">Interfaces con clases en C++</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id10">CTypes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Ejercicios de Clase</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ejercicios.html">Ejercicios</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="entregas_ejercicios.html">Entrega de ejercicios</a></li>
<li class="toctree-l1"><a class="reference internal" href="programa_detalle.html">Programa Detallado</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Clases de Python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Clase 15: Interfaces con otros lenguajes</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/clase_15.rst.txt" rel="nofollow"> Ver c√≥digo fuente de la p√°gina</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="clase-15-interfaces-con-otros-lenguajes">
<span id="clase-15"></span><h1>Clase 15: Interfaces con otros lenguajes<a class="headerlink" href="#clase-15-interfaces-con-otros-lenguajes" title="Permalink to this heading">ÔÉÅ</a></h1>
<p>A diferencia de <strong>Python</strong>, tanto <strong>Fortran</strong> como <strong>C</strong> y <strong>C++</strong> son
lenguajes <em>compilados</em>: el c√≥digo fuente tiene que se convertido a un
lenguaje ejecutable para poder ser utilizado. Como mencionamos
anteriormente, esto suele ser muy conveniente en el flujo de
programaci√≥n usual pero puede haber casos en que el c√≥digo en Python es
notablemente m√°s lento, o casos en que ya existen rutinas en otros
lenguajes y convertirlas a un nuevo lenguaje sea mucho trabajo. En esos
casos, una soluci√≥n posible y conveniente es utilizar un lenguaje
compilado para rutinas espec√≠ficas y Python para todo el resto del
trabajo (entrada/salida, manejo de datos, graficaci√≥n, etc).</p>
<section id="ejemplo-1-rotacion-de-vectores">
<h2>Ejemplo 1: Rotaci√≥n de vectores<a class="headerlink" href="#ejemplo-1-rotacion-de-vectores" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>Supongamos que queremos resolver el problema de la rotaci√≥n de vectores
en el espacio usando los <a class="reference external" href="https://mathworld.wolfram.com/EulerAngles.html">tres √°ngulos de
Euler</a>.</p>
<p>Dado un array con los tres √°ngulos de Euler, calculamos la matriz de
rotaci√≥n (de 3 x 3), y la aplicamos (esto es, multiplicamos) a un
arreglo de <em>N</em> vectores.</p>
<p>En una primera versi√≥n, podemos hacerlo en Python directamente en el
notebook:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">matrix_rotation</span><span class="p">(</span><span class="n">angles</span><span class="p">):</span>
  <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">cz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
  <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
  <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">cz</span> <span class="o">-</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">sz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">cz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">sy</span>

  <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sx</span> <span class="o">*</span> <span class="n">cz</span> <span class="o">-</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">sz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sx</span> <span class="o">*</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">cz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">sy</span>

  <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sy</span> <span class="o">*</span> <span class="n">sz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sy</span> <span class="o">*</span> <span class="n">cz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cy</span>
  <span class="k">return</span> <span class="n">R</span>


<span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">matrix_rotation</span><span class="p">(</span><span class="n">angles</span><span class="p">),</span> <span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<span class="c1"># √Ångulos de Euler</span>
<span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># Definimos N vectores tridimensionales</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
</pre></div>
</div>
<p>Si ya tenemos un m√≥dulo donde est√°n programadas las funciones necesarias</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load rotacion_p.py</span>
<span class="c1">#! /usr/bin/ipython3</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">def</span> <span class="nf">matrix_rotation</span><span class="p">(</span><span class="n">angles</span><span class="p">):</span>
  <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">cz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
  <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
  <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">cz</span> <span class="o">-</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">sz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">cz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">sy</span>

  <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sx</span> <span class="o">*</span> <span class="n">cz</span> <span class="o">-</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">sz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sx</span> <span class="o">*</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">cz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">sy</span>

  <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sy</span> <span class="o">*</span> <span class="n">sz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sy</span> <span class="o">*</span> <span class="n">cz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cy</span>
  <span class="k">return</span> <span class="n">R</span>


<span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">matrix_rotation</span><span class="p">(</span><span class="n">angles</span><span class="p">),</span> <span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
<p>es f√°cil utilizarlas:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<span class="c1"># √Ångulos de Euler</span>
<span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># Definimos N vectores tridimensionales</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mf">0.46144087</span> <span class="mf">0.94917928</span> <span class="mf">0.03988238</span><span class="p">]</span>
<span class="p">[[</span> <span class="mf">1.14526353</span>  <span class="mf">0.89893142</span> <span class="o">-</span><span class="mf">0.20839548</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.86773171</span>  <span class="mf">0.58052202</span> <span class="o">-</span><span class="mf">0.35062842</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.14634894</span>  <span class="mf">0.19684473</span>  <span class="mf">0.1321415</span> <span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.1872209</span>   <span class="mf">0.29561624</span> <span class="o">-</span><span class="mf">0.2203384</span> <span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.75371008</span>  <span class="mf">0.18101728</span>  <span class="mf">0.2312093</span> <span class="p">]]</span>
</pre></div>
</div>
<section id="importando-desde-un-modulo-en-un-archivo">
<h3>Importando desde un m√≥dulo en un archivo<a class="headerlink" href="#importando-desde-un-modulo-en-un-archivo" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Tambi√©n podemos tener las funciones para la rotaci√≥n en un m√≥dulo
<code class="docutils literal notranslate"><span class="pre">rotaciones.py</span></code>. Recordemos c√≥mo se importar√≠an en este caso</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pwd</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;/home/fiol/Clases/IntPython/clases-python/clases&#39;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">../</span><span class="n">scripts</span><span class="o">/</span><span class="n">interfacing_python</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">fiol</span><span class="o">/</span><span class="n">Clases</span><span class="o">/</span><span class="n">IntPython</span><span class="o">/</span><span class="n">clases</span><span class="o">-</span><span class="n">python</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">interfacing_python</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ls</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[0m[01;34m__pycache__[0m/  rotaciones.py
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rotaciones</span> <span class="k">as</span> <span class="nn">rotp</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">rotp</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Help</span> <span class="n">on</span> <span class="n">module</span> <span class="n">rotaciones</span><span class="p">:</span>

<span class="n">NAME</span>
    <span class="n">rotaciones</span>

<span class="n">FUNCTIONS</span>
    <span class="n">matrix_rotation</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>

    <span class="n">rotate</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

<span class="n">FILE</span>
    <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">fiol</span><span class="o">/</span><span class="n">Clases</span><span class="o">/</span><span class="n">IntPython</span><span class="o">/</span><span class="n">clases</span><span class="o">-</span><span class="n">python</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">interfacing_python</span><span class="o">/</span><span class="n">rotaciones</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">yp</span> <span class="o">=</span> <span class="n">rotp</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">yp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">yp</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span> <span class="mf">1.14526353</span>  <span class="mf">0.89893142</span> <span class="o">-</span><span class="mf">0.20839548</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.86773171</span>  <span class="mf">0.58052202</span> <span class="o">-</span><span class="mf">0.35062842</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.14634894</span>  <span class="mf">0.19684473</span>  <span class="mf">0.1321415</span> <span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.1872209</span>   <span class="mf">0.29561624</span> <span class="o">-</span><span class="mf">0.2203384</span> <span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.75371008</span>  <span class="mf">0.18101728</span>  <span class="mf">0.2312093</span> <span class="p">]]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kc">True</span>
</pre></div>
</div>
</section>
</section>
<section id="interfaces-con-fortran">
<h2>Interfaces con Fortran<a class="headerlink" href="#interfaces-con-fortran" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>Veamos c√≥mo trabajar si tenemos el c√≥digo para realizar las rotaciones
en Fortran</p>
<section id="primer-ejemplo-nuestro-codigo">
<h3>Primer ejemplo: Nuestro c√≥digo<a class="headerlink" href="#primer-ejemplo-nuestro-codigo" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>El c√≥digo en Fortran que tenemos es:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">function </span><span class="n">rotate</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="k">implicit none</span>
<span class="k">  </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">theta</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">y</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">R</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cx</span><span class="p">,</span><span class="w"> </span><span class="n">cy</span><span class="p">,</span><span class="w"> </span><span class="n">cz</span><span class="p">,</span><span class="w"> </span><span class="n">sx</span><span class="p">,</span><span class="w"> </span><span class="n">sy</span><span class="p">,</span><span class="w"> </span><span class="n">sz</span><span class="w"></span>

<span class="w">  </span><span class="c">! Senos y Cosenos de los tres √°ngulos de Euler</span>
<span class="w">  </span><span class="n">cx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span><span class="w"> </span><span class="n">cy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span><span class="w"> </span><span class="n">cz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="w"></span>
<span class="w">  </span><span class="n">sx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span><span class="w"> </span><span class="n">sy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span><span class="w"> </span><span class="n">sz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="w"></span>

<span class="w">  </span><span class="c">! Matriz de rotaci√≥n</span>
<span class="w">  </span><span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cx</span><span class="o">*</span><span class="n">cz</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sx</span><span class="o">*</span><span class="n">cy</span><span class="o">*</span><span class="n">sz</span><span class="w"></span>
<span class="w">  </span><span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cx</span><span class="o">*</span><span class="n">sz</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sx</span><span class="o">*</span><span class="n">cy</span><span class="o">*</span><span class="n">cz</span><span class="w"></span>
<span class="w">  </span><span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sx</span><span class="o">*</span><span class="n">sy</span><span class="w"></span>

<span class="w">  </span><span class="n">R</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">sx</span><span class="o">*</span><span class="n">cz</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cx</span><span class="o">*</span><span class="n">cy</span><span class="o">*</span><span class="n">sz</span><span class="w"></span>
<span class="w">  </span><span class="n">R</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">sx</span><span class="o">*</span><span class="n">sz</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cx</span><span class="o">*</span><span class="n">cy</span><span class="o">*</span><span class="n">cz</span><span class="w"></span>
<span class="w">  </span><span class="n">R</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cx</span><span class="o">*</span><span class="n">sy</span><span class="w"></span>

<span class="w">  </span><span class="n">R</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sy</span><span class="o">*</span><span class="n">sz</span><span class="w"></span>
<span class="w">  </span><span class="n">R</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">sy</span><span class="o">*</span><span class="n">cz</span><span class="w"></span>
<span class="w">  </span><span class="n">R</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cy</span><span class="w"></span>

<span class="w">  </span><span class="c">! Aplicamos la rotaci√≥n</span>
<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">matmul</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"></span>
<span class="k">end function </span><span class="n">rotate</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">../</span><span class="n">interfacing_F</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">fiol</span><span class="o">/</span><span class="n">Clases</span><span class="o">/</span><span class="n">IntPython</span><span class="o">/</span><span class="n">clases</span><span class="o">-</span><span class="n">python</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">interfacing_F</span>
</pre></div>
</div>
</section>
<section id="f2py">
<h3>F2PY<a class="headerlink" href="#f2py" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>F2PY -Fortran to Python interface generator- es una utilidad que permite
generar una interface para utilizar funciones y datos definidos en
Fortran desde Python.</p>
<p>Informaci√≥n sobre la interfaz entre Fotran y Python, y en particular
sobre F2PY, puede encontrarse en:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://scipy-cookbook.readthedocs.io/items/idx_interfacing_with_other_languages.html">Scipy
cookbook</a></p></li>
<li><p><a class="reference external" href="https://docs.scipy.org/doc/numpy-dev/f2py/index.html">F2PY Users Guide and Reference
Manual</a></p></li>
<li><p><a class="reference external" href="http://www.fortran90.org/src/best-practices.html#interfacing-with-python">Fortran Best
Practices</a></p></li>
<li><p><a class="reference external" href="http://websrv.cs.umt.edu/isis/index.php/F2py_example">http://websrv.cs.umt.edu/isis/index.php/F2py_example</a></p></li>
</ul>
<p>El primer paso es utilizar esta utilidad:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ f2py3 -c rotacion.f90 -m rotacion_f
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!f2py3 -c rotacion.f90 -m rotacion_f
</pre></div>
</div>
<pre class="literal-block">[39mrunning build[0m
[39mrunning config_cc[0m
[39mINFO: unifing config_cc, config, build_clib, build_ext, build commands --compiler options[0m
[39mrunning config_fc[0m
[39mINFO: unifing config_fc, config, build_clib, build_ext, build commands --fcompiler options[0m
[39mrunning build_src[0m
[39mINFO: build_src[0m
[39mINFO: building extension &quot;rotacion_f&quot; sources[0m
[39mINFO: f2py options: [][0m
[39mINFO: f2py:&gt; /tmp/tmpo4f_n_vl/src.linux-x86_64-3.11/rotacion_fmodule.c[0m
[39mcreating /tmp/tmpo4f_n_vl/src.linux-x86_64-3.11[0m
Reading fortran codes...
    Reading file 'rotacion.f90' (format:free)
Post-processing...
    Block: rotacion_f
                    Block: rotaciones
                            Block: matrix_rotation
appenddecl: &quot;dimension&quot; not implemented.
                            Block: rotate
appenddecl: &quot;dimension&quot; not implemented.
                    Block: test_rotation
Post-processing (stage 2)...
    Block: rotacion_f
            Block: unknown_interface
                    Block: rotaciones
                            Block: matrix_rotation
                            Block: rotate
                    Block: test_rotation
Building modules...
    Building module &quot;rotacion_f&quot;...
            Constructing F90 module support for &quot;rotaciones&quot;...
            Creating wrapper for Fortran function &quot;matrix_rotation&quot;(&quot;matrix_rotation&quot;)...
            Constructing wrapper function &quot;rotaciones.matrix_rotation&quot;...
              r = matrix_rotation(angles)
            Creating wrapper for Fortran function &quot;rotate&quot;(&quot;rotate&quot;)...
            Constructing wrapper function &quot;rotaciones.rotate&quot;...
              y = rotate(angles,v,[n])
    Wrote C/API module &quot;rotacion_f&quot; to file &quot;/tmp/tmpo4f_n_vl/src.linux-x86_64-3.11/rotacion_fmodule.c&quot;
    Fortran 90 wrappers are saved to &quot;/tmp/tmpo4f_n_vl/src.linux-x86_64-3.11/rotacion_f-f2pywrappers2.f90&quot;
[39mINFO:   adding '/tmp/tmpo4f_n_vl/src.linux-x86_64-3.11/fortranobject.c' to sources.[0m
[39mINFO:   adding '/tmp/tmpo4f_n_vl/src.linux-x86_64-3.11' to include_dirs.[0m
[39mcopying /usr/lib64/python3.11/site-packages/numpy/f2py/src/fortranobject.c -&gt; /tmp/tmpo4f_n_vl/src.linux-x86_64-3.11[0m
[39mcopying /usr/lib64/python3.11/site-packages/numpy/f2py/src/fortranobject.h -&gt; /tmp/tmpo4f_n_vl/src.linux-x86_64-3.11[0m
[39mINFO:   adding '/tmp/tmpo4f_n_vl/src.linux-x86_64-3.11/rotacion_f-f2pywrappers2.f90' to sources.[0m
[39mINFO: build_src: building npy-pkg config files[0m
/usr/lib/python3.11/site-packages/setuptools/command/install.py:34: SetuptoolsDeprecationWarning: setup.py install is deprecated. Use build and pip and other standards-based tools.
  warnings.warn(
[39mrunning build_ext[0m
[39mINFO: customize UnixCCompiler[0m
[39mINFO: customize UnixCCompiler using build_ext[0m
[39mINFO: get_default_fcompiler: matching types: '['arm', 'gnu95', 'intel', 'lahey', 'pg', 'nv', 'absoft', 'nag', 'vast', 'compaq', 'intele', 'intelem', 'gnu', 'g95', 'pathf95', 'nagfor', 'fujitsu']'[0m
[39mINFO: customize ArmFlangCompiler[0m
[31mWARN: Could not locate executable armflang[0m
[39mINFO: customize Gnu95FCompiler[0m
[39mINFO: Found executable /usr/bin/gfortran[0m
[39mINFO: customize Gnu95FCompiler[0m
[39mINFO: customize Gnu95FCompiler using build_ext[0m
[39mINFO: building 'rotacion_f' extension[0m
[39mINFO: compiling C sources[0m
[39mINFO: C compiler: gcc -Wsign-compare -DDYNAMIC_ANNOTATIONS_ENABLED=1 -DNDEBUG -O2 -fexceptions -g -grecord-gcc-switches -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -fstack-protector-strong -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -D_GNU_SOURCE -fPIC -fwrapv -O2 -fexceptions -g -grecord-gcc-switches -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -fstack-protector-strong -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -D_GNU_SOURCE -fPIC -fwrapv -O2 -fexceptions -g -grecord-gcc-switches -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -fstack-protector-strong -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -D_GNU_SOURCE -fPIC -fwrapv -fPIC
[0m
[39mcreating /tmp/tmpo4f_n_vl/tmp[0m
[39mcreating /tmp/tmpo4f_n_vl/tmp/tmpo4f_n_vl[0m
[39mcreating /tmp/tmpo4f_n_vl/tmp/tmpo4f_n_vl/src.linux-x86_64-3.11[0m
[39mINFO: compile options: '-DNPY_DISABLE_OPTIMIZATION=1 -I/tmp/tmpo4f_n_vl/src.linux-x86_64-3.11 -I/usr/lib64/python3.11/site-packages/numpy/core/include -I/usr/include/python3.11 -c'[0m
[39mINFO: gcc: /tmp/tmpo4f_n_vl/src.linux-x86_64-3.11/rotacion_fmodule.c[0m
[39mINFO: gcc: /tmp/tmpo4f_n_vl/src.linux-x86_64-3.11/fortranobject.c[0m
In file included from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/ndarraytypes.h:1960[m[K,
                 from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/ndarrayobject.h:12[m[K,
                 from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/arrayobject.h:5[m[K,
                 from [01m[K/tmp/tmpo4f_n_vl/src.linux-x86_64-3.11/fortranobject.h:13[m[K,
                 from [01m[K/tmp/tmpo4f_n_vl/src.linux-x86_64-3.11/fortranobject.c:2[m[K:
[01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.h:17:2:[m[K [01;35m[Kwarning: [m[K#warning &quot;Using deprecated NumPy API, disable it with &quot; &quot;#define NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION&quot; [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wcpp-Wcpp]8;;[m[K]
   17 | #[01;35m[Kwarning[m[K &quot;Using deprecated NumPy API, disable it with &quot;       |  [01;35m[K^~~~~~~[m[K
In file included from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/ndarraytypes.h:1960[m[K,
                 from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/ndarrayobject.h:12[m[K,
                 from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/arrayobject.h:5[m[K,
                 from [01m[K/tmp/tmpo4f_n_vl/src.linux-x86_64-3.11/fortranobject.h:13[m[K,
                 from [01m[K/tmp/tmpo4f_n_vl/src.linux-x86_64-3.11/rotacion_fmodule.c:20[m[K:
[01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.h:17:2:[m[K [01;35m[Kwarning: [m[K#warning &quot;Using deprecated NumPy API, disable it with &quot; &quot;#define NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION&quot; [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wcpp-Wcpp]8;;[m[K]
   17 | #[01;35m[Kwarning[m[K &quot;Using deprecated NumPy API, disable it with &quot;       |  [01;35m[K^~~~~~~[m[K
[01m[K/tmp/tmpo4f_n_vl/src.linux-x86_64-3.11/rotacion_fmodule.c:113:12:[m[K [01;35m[Kwarning: [m[K‚Äò[01m[Kf2py_size[m[K‚Äô defined but not used [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wunused-function-Wunused-function]8;;[m[K]
  113 | static int [01;35m[Kf2py_size[m[K(PyArrayObject* var, ...)
      |            [01;35m[K^~~~~~~~~[m[K
[39mINFO: compiling Fortran 90 module sources[0m
[39mINFO: Fortran f77 compiler: /usr/bin/gfortran -Wall -g -ffixed-form -fno-second-underscore -fPIC -O3 -funroll-loops
Fortran f90 compiler: /usr/bin/gfortran -Wall -g -fno-second-underscore -fPIC -O3 -funroll-loops
Fortran fix compiler: /usr/bin/gfortran -Wall -g -ffixed-form -fno-second-underscore -Wall -g -fno-second-underscore -fPIC -O3 -funroll-loops[0m
[39mINFO: compile options: '-I/tmp/tmpo4f_n_vl/src.linux-x86_64-3.11 -I/usr/lib64/python3.11/site-packages/numpy/core/include -I/usr/include/python3.11 -c'
extra options: '-J/tmp/tmpo4f_n_vl/ -I/tmp/tmpo4f_n_vl/'[0m
[39mINFO: gfortran:f90: rotacion.f90[0m
[01m[Krotacion.f90:56:24:[m[K

   56 |   integer :: n, Nloops,i,j
      |                        [01;35m[K1[m[K
[01;35m[KWarning:[m[K Unused variable ‚Äò[01m[Ki[m[K‚Äô declared at [01;35m[K(1)[m[K [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wunused-variable-Wunused-variable]8;;[m[K]
[01m[Krotacion.f90:56:26:[m[K

   56 |   integer :: n, Nloops,i,j
      |                          [01;35m[K1[m[K
[01;35m[KWarning:[m[K Unused variable ‚Äò[01m[Kj[m[K‚Äô declared at [01;35m[K(1)[m[K [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wunused-variable-Wunused-variable]8;;[m[K]
[01m[Krotacion.f90:59:31:[m[K

   59 |   real(8), dimension(3, 3) :: R
      |                               [01;35m[K1[m[K
[01;35m[KWarning:[m[K Unused variable ‚Äò[01m[Kr[m[K‚Äô declared at [01;35m[K(1)[m[K [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wunused-variable-Wunused-variable]8;;[m[K]
[01m[Krotacion.f90:44:42:[m[K

   44 |     y = matmul(matrix_rotation(angles), v)
      |                                          [01;35m[K^[m[K
[01;35m[KWarning:[m[K ‚Äò[01m[K__var_1_mma.offset[m[K‚Äô is used uninitialized [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wuninitialized-Wuninitialized]8;;[m[K]
[01m[Krotacion.f90:47:21:[m[K

   47 | end module rotaciones
      |                     [01;36m[K^[m[K
[01;36m[Knote:[m[K ‚Äò[01m[K__var_1_mma[m[K‚Äô declared here
[01m[Krotacion.f90:44:42:[m[K

   44 |     y = matmul(matrix_rotation(angles), v)
      |                                          [01;35m[K^[m[K
[01;35m[KWarning:[m[K ‚Äò[01m[K__var_1_mma.dim[0].lbound[m[K‚Äô is used uninitialized [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wuninitialized-Wuninitialized]8;;[m[K]
[01m[Krotacion.f90:47:21:[m[K

   47 | end module rotaciones
      |                     [01;36m[K^[m[K
[01;36m[Knote:[m[K ‚Äò[01m[K__var_1_mma[m[K‚Äô declared here
[01m[Krotacion.f90:44:42:[m[K

   44 |     y = matmul(matrix_rotation(angles), v)
      |                                          [01;35m[K^[m[K
[01;35m[KWarning:[m[K ‚Äò[01m[K__var_1_mma.dim[0].ubound[m[K‚Äô is used uninitialized [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wuninitialized-Wuninitialized]8;;[m[K]
[01m[Krotacion.f90:47:21:[m[K

   47 | end module rotaciones
      |                     [01;36m[K^[m[K
[01;36m[Knote:[m[K ‚Äò[01m[K__var_1_mma[m[K‚Äô declared here
[01m[Krotacion.f90:44:42:[m[K

   44 |     y = matmul(matrix_rotation(angles), v)
      |                                          [01;35m[K^[m[K
[01;35m[KWarning:[m[K ‚Äò[01m[K__var_1_mma.dim[1].lbound[m[K‚Äô is used uninitialized [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wuninitialized-Wuninitialized]8;;[m[K]
[01m[Krotacion.f90:47:21:[m[K

   47 | end module rotaciones
      |                     [01;36m[K^[m[K
[01;36m[Knote:[m[K ‚Äò[01m[K__var_1_mma[m[K‚Äô declared here
[01m[Krotacion.f90:44:42:[m[K

   44 |     y = matmul(matrix_rotation(angles), v)
      |                                          [01;35m[K^[m[K
[01;35m[KWarning:[m[K ‚Äò[01m[K__var_1_mma.dim[1].ubound[m[K‚Äô is used uninitialized [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wuninitialized-Wuninitialized]8;;[m[K]
[01m[Krotacion.f90:47:21:[m[K

   47 | end module rotaciones
      |                     [01;36m[K^[m[K
[01;36m[Knote:[m[K ‚Äò[01m[K__var_1_mma[m[K‚Äô declared here
[39mINFO: compiling Fortran sources[0m
[39mINFO: Fortran f77 compiler: /usr/bin/gfortran -Wall -g -ffixed-form -fno-second-underscore -fPIC -O3 -funroll-loops
Fortran f90 compiler: /usr/bin/gfortran -Wall -g -fno-second-underscore -fPIC -O3 -funroll-loops
Fortran fix compiler: /usr/bin/gfortran -Wall -g -ffixed-form -fno-second-underscore -Wall -g -fno-second-underscore -fPIC -O3 -funroll-loops[0m
[39mINFO: compile options: '-I/tmp/tmpo4f_n_vl/src.linux-x86_64-3.11 -I/usr/lib64/python3.11/site-packages/numpy/core/include -I/usr/include/python3.11 -c'
extra options: '-J/tmp/tmpo4f_n_vl/ -I/tmp/tmpo4f_n_vl/'[0m
[39mINFO: gfortran:f90: /tmp/tmpo4f_n_vl/src.linux-x86_64-3.11/rotacion_f-f2pywrappers2.f90[0m
[01m[K/tmp/tmpo4f_n_vl/src.linux-x86_64-3.11/rotacion_f-f2pywrappers2.f90:5:52:[m[K

    5 |       subroutine f2pywrap_rotaciones_matrix_rotation (matrix_rotationf2p&amp;
      |                                                    [01;35m[K1[m[K
......
   24 |       subroutine f2pywrap_rotaciones_matrix_rotation (matrix_rotationf2p&amp;
      |                                                    [32m[K2[m[K
[01;35m[KWarning:[m[K Rank mismatch in argument 'matrix_rotation' (2/1) between [01;35m[K(1)[m[K and [32m[K(2)[m[K
[01m[K/tmp/tmpo4f_n_vl/src.linux-x86_64-3.11/rotacion_f-f2pywrappers2.f90:12:43:[m[K

   12 |       subroutine f2pywrap_rotaciones_rotate (rotatef2pywrap, angles, v, &amp;
      |                                           [01;35m[K1[m[K
......
   30 |       subroutine f2pywrap_rotaciones_rotate (rotatef2pywrap, rotate, ang&amp;
      |                                           [32m[K2[m[K
[01;35m[KWarning:[m[K Rank mismatch in argument 'rotate' (2/1) between [01;35m[K(1)[m[K and [32m[K(2)[m[K
[39mINFO: /usr/bin/gfortran -Wall -g -Wall -g -shared /tmp/tmpo4f_n_vl/tmp/tmpo4f_n_vl/src.linux-x86_64-3.11/rotacion_fmodule.o /tmp/tmpo4f_n_vl/tmp/tmpo4f_n_vl/src.linux-x86_64-3.11/fortranobject.o /tmp/tmpo4f_n_vl/rotacion.o /tmp/tmpo4f_n_vl/tmp/tmpo4f_n_vl/src.linux-x86_64-3.11/rotacion_f-f2pywrappers2.o -L/usr/lib/gcc/x86_64-redhat-linux/12 -L/usr/lib/gcc/x86_64-redhat-linux/12 -L/usr/lib64 -lgfortran -o ./rotacion_f.cpython-311-x86_64-linux-gnu.so[0m
Removing build directory /tmp/tmpo4f_n_vl</pre>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rotacion_f</span> <span class="kn">import</span> <span class="n">rotaciones</span> <span class="k">as</span> <span class="n">rotf</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">yf</span> <span class="o">=</span> <span class="n">rotf</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">yf</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">yf</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span> <span class="mf">1.14526353</span>  <span class="mf">0.89893142</span> <span class="o">-</span><span class="mf">0.20839548</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.86773171</span>  <span class="mf">0.58052202</span> <span class="o">-</span><span class="mf">0.35062842</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.14634894</span>  <span class="mf">0.19684473</span>  <span class="mf">0.1321415</span> <span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.1872209</span>   <span class="mf">0.29561624</span> <span class="o">-</span><span class="mf">0.2203384</span> <span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.75371008</span>  <span class="mf">0.18101728</span>  <span class="mf">0.2312093</span> <span class="p">]]</span>
<span class="p">[[</span> <span class="mf">1.14526353</span>  <span class="mf">0.89893142</span> <span class="o">-</span><span class="mf">0.20839548</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.86773171</span>  <span class="mf">0.58052202</span> <span class="o">-</span><span class="mf">0.35062842</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.14634894</span>  <span class="mf">0.19684473</span>  <span class="mf">0.1321415</span> <span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.1872209</span>   <span class="mf">0.29561624</span> <span class="o">-</span><span class="mf">0.2203384</span> <span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.75371008</span>  <span class="mf">0.18101728</span>  <span class="mf">0.2312093</span> <span class="p">]]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kc">True</span>
</pre></div>
</div>
<p>Veamos qu√© es exactamente lo que importamos:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">rotf</span><span class="o">.</span><span class="n">rotate</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">y = rotate(angles,v,[n])

Wrapper for <code class="docutils literal notranslate"><span class="pre">rotate</span></code>.

Parameters
----------
angles : input rank-1 array('d') with bounds (3)
v : input rank-2 array('d') with bounds (3,n)

Other Parameters
----------------
n : input int, optional
    Default: shape(v, 1)

Returns
-------
y : rank-2 array('d') with bounds (3,n) and rotate storage</pre>
<p>Como vemos, estamos usando la funci√≥n <code class="docutils literal notranslate"><span class="pre">rotate</span></code> definida en Fortran.
Notar que: * Tiene tres argumentos. * Dos argumentos requeridos:
<code class="docutils literal notranslate"><span class="pre">angles</span></code> y <code class="docutils literal notranslate"><span class="pre">v</span></code> * Un argumento, correspondiente a la dimensi√≥n <code class="docutils literal notranslate"><span class="pre">n</span></code>
que F2PY autom√°ticamente detecta como opcional.</p>
</section>
<section id="segundo-ejemplo-codigo-heredado">
<h3>Segundo Ejemplo: C√≥digo heredado<a class="headerlink" href="#segundo-ejemplo-codigo-heredado" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>La conversi√≥n que realizamos con f2py3 la podr√≠amos haber realizado en
dos pasos:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ f2py3 rotacion.f90 -m rotacion_f -h rotacion.pyf
$ f2py3 -c rotacion.pyf -m rotacion_f
</pre></div>
</div>
<p>En el primer paso se crea un archivo <em>signature</em> que despu√©s se utiliza
para crear el m√≥dulo que llamaremos desde <strong>Python</strong>. Haci√©ndolo en dos
pasos nos permite modificar el texto del archivo <em>.pyf</em> antes de
ejecutar el segundo comando.</p>
<p>Esto es √∫til cuando el c√≥digo original no es lo suficientemente
‚Äúmoderno‚Äù, no tiene toda la informaci√≥n necesaria sobre los argumentos o
es un c√≥digo que uno no quiere o puede editar. Veamos que forma tienen
con un ejemplo m√°s simple (tomado de la <a class="reference external" href="https://docs.scipy.org/doc/numpy-dev/f2py/getting-started.html">gu√≠a de
usuario</a>):</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="k">SUBROUTINE </span><span class="n">FIB</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="n">C</span><span class="w"></span>
<span class="n">C</span><span class="w">     </span><span class="n">CALCULATE</span><span class="w"> </span><span class="n">FIRST</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="n">FIBONACCI</span><span class="w"> </span><span class="n">NUMBERS</span><span class="w"></span>
<span class="n">C</span><span class="w"></span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">N</span><span class="w"></span>
<span class="w">      </span><span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="n">I</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">A</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0D0</span><span class="w"></span>
<span class="w">         </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="n">I</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">A</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0D0</span><span class="w"></span>
<span class="w">         </span><span class="k">ELSE</span>
<span class="k">            </span><span class="n">A</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">      ENDDO</span>
<span class="k">      END</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!f2py3 --overwrite-signature fib1.f -m fib1 -h fib1.pyf
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Reading</span> <span class="n">fortran</span> <span class="n">codes</span><span class="o">...</span>
    <span class="n">Reading</span> <span class="n">file</span> <span class="s1">&#39;fib1.f&#39;</span> <span class="p">(</span><span class="nb">format</span><span class="p">:</span><span class="n">fix</span><span class="p">,</span><span class="n">strict</span><span class="p">)</span>
<span class="n">Post</span><span class="o">-</span><span class="n">processing</span><span class="o">...</span>
    <span class="n">Block</span><span class="p">:</span> <span class="n">fib1</span>
                    <span class="n">Block</span><span class="p">:</span> <span class="n">fib</span>
<span class="n">Post</span><span class="o">-</span><span class="n">processing</span> <span class="p">(</span><span class="n">stage</span> <span class="mi">2</span><span class="p">)</span><span class="o">...</span>
<span class="n">Saving</span> <span class="n">signatures</span> <span class="n">to</span> <span class="n">file</span> <span class="s2">&quot;./fib1.pyf&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!cat fib1.pyf
</pre></div>
</div>
<pre class="literal-block">!    -<em>- f90 -</em>-
! Note: the context of this file is case sensitive.

python module fib1 ! in
    interface  ! in :fib1
        subroutine fib(a,n) ! in :fib1:fib1.f
            real*8 dimension(n) :: a
            integer, optional,check(shape(a, 0) == n),depend(a) :: n=shape(a, 0)
        end subroutine fib
    end interface
end python module fib1

! This file was auto-generated with f2py (version:1.22.0).
! See:
! https://web.archive.org/web/20140822061353/http://cens.ioc.ee/projects/f2py2e</pre>
<p>El contenido del archivo <code class="docutils literal notranslate"><span class="pre">fib1.pyf</span></code> es:</p>
<div class="highlight-fortran90 notranslate"><div class="highlight"><pre><span></span>python module fib1 ! in
    interface  ! in :fib1
        subroutine fib(a,n) ! in :fib1:fib1.f
            real*8 dimension(n) :: a
            integer, optional,check(len(a)&gt;=n),depend(a) :: n=len(a)
        end subroutine fib
    end interface
end python module fib1
</pre></div>
</div>
<p>Este c√≥digo indica que tenemos una subrutina que toma dos argumentos: -
<code class="docutils literal notranslate"><span class="pre">a</span></code> es un array - <code class="docutils literal notranslate"><span class="pre">n</span></code> es un entero opcional, que tiene que ser mayor
que <code class="docutils literal notranslate"><span class="pre">len(a)</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!f2py3  -c fib1.pyf fib1.f
</pre></div>
</div>
<pre class="literal-block">[39mrunning build[0m
[39mrunning config_cc[0m
[39mINFO: unifing config_cc, config, build_clib, build_ext, build commands --compiler options[0m
[39mrunning config_fc[0m
[39mINFO: unifing config_fc, config, build_clib, build_ext, build commands --fcompiler options[0m
[39mrunning build_src[0m
[39mINFO: build_src[0m
[39mINFO: building extension &quot;fib1&quot; sources[0m
[39mcreating /tmp/tmpi2rk3q9t/src.linux-x86_64-3.11[0m
[39mINFO: f2py options: [][0m
[39mINFO: f2py: fib1.pyf[0m
Reading fortran codes...
    Reading file 'fib1.pyf' (format:free)
Post-processing...
    Block: fib1
                    Block: fib
Post-processing (stage 2)...
Building modules...
    Building module &quot;fib1&quot;...
        Constructing wrapper function &quot;fib&quot;...
          fib(a,[n])
    Wrote C/API module &quot;fib1&quot; to file &quot;/tmp/tmpi2rk3q9t/src.linux-x86_64-3.11/fib1module.c&quot;
[39mINFO:   adding '/tmp/tmpi2rk3q9t/src.linux-x86_64-3.11/fortranobject.c' to sources.[0m
[39mINFO:   adding '/tmp/tmpi2rk3q9t/src.linux-x86_64-3.11' to include_dirs.[0m
[39mcopying /usr/lib64/python3.11/site-packages/numpy/f2py/src/fortranobject.c -&gt; /tmp/tmpi2rk3q9t/src.linux-x86_64-3.11[0m
[39mcopying /usr/lib64/python3.11/site-packages/numpy/f2py/src/fortranobject.h -&gt; /tmp/tmpi2rk3q9t/src.linux-x86_64-3.11[0m
[39mINFO: build_src: building npy-pkg config files[0m
/usr/lib/python3.11/site-packages/setuptools/command/install.py:34: SetuptoolsDeprecationWarning: setup.py install is deprecated. Use build and pip and other standards-based tools.
  warnings.warn(
[39mrunning build_ext[0m
[39mINFO: customize UnixCCompiler[0m
[39mINFO: customize UnixCCompiler using build_ext[0m
[39mINFO: get_default_fcompiler: matching types: '['arm', 'gnu95', 'intel', 'lahey', 'pg', 'nv', 'absoft', 'nag', 'vast', 'compaq', 'intele', 'intelem', 'gnu', 'g95', 'pathf95', 'nagfor', 'fujitsu']'[0m
[39mINFO: customize ArmFlangCompiler[0m
[31mWARN: Could not locate executable armflang[0m
[39mINFO: customize Gnu95FCompiler[0m
[39mINFO: Found executable /usr/bin/gfortran[0m
[39mINFO: customize Gnu95FCompiler[0m
[39mINFO: customize Gnu95FCompiler using build_ext[0m
[39mINFO: building 'fib1' extension[0m
[39mINFO: compiling C sources[0m
[39mINFO: C compiler: gcc -Wsign-compare -DDYNAMIC_ANNOTATIONS_ENABLED=1 -DNDEBUG -O2 -fexceptions -g -grecord-gcc-switches -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -fstack-protector-strong -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -D_GNU_SOURCE -fPIC -fwrapv -O2 -fexceptions -g -grecord-gcc-switches -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -fstack-protector-strong -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -D_GNU_SOURCE -fPIC -fwrapv -O2 -fexceptions -g -grecord-gcc-switches -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -fstack-protector-strong -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -D_GNU_SOURCE -fPIC -fwrapv -fPIC
[0m
[39mcreating /tmp/tmpi2rk3q9t/tmp[0m
[39mcreating /tmp/tmpi2rk3q9t/tmp/tmpi2rk3q9t[0m
[39mcreating /tmp/tmpi2rk3q9t/tmp/tmpi2rk3q9t/src.linux-x86_64-3.11[0m
[39mINFO: compile options: '-DNPY_DISABLE_OPTIMIZATION=1 -I/tmp/tmpi2rk3q9t/src.linux-x86_64-3.11 -I/usr/lib64/python3.11/site-packages/numpy/core/include -I/usr/include/python3.11 -c'[0m
[39mINFO: gcc: /tmp/tmpi2rk3q9t/src.linux-x86_64-3.11/fib1module.c[0m
[39mINFO: gcc: /tmp/tmpi2rk3q9t/src.linux-x86_64-3.11/fortranobject.c[0m
In file included from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/ndarraytypes.h:1960[m[K,
                 from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/ndarrayobject.h:12[m[K,
                 from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/arrayobject.h:5[m[K,
                 from [01m[K/tmp/tmpi2rk3q9t/src.linux-x86_64-3.11/fortranobject.h:13[m[K,
                 from [01m[K/tmp/tmpi2rk3q9t/src.linux-x86_64-3.11/fib1module.c:20[m[K:
[01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.h:17:2:[m[K [01;35m[Kwarning: [m[K#warning &quot;Using deprecated NumPy API, disable it with &quot; &quot;#define NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION&quot; [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wcpp-Wcpp]8;;[m[K]
   17 | #[01;35m[Kwarning[m[K &quot;Using deprecated NumPy API, disable it with &quot;       |  [01;35m[K^~~~~~~[m[K
In file included from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/ndarraytypes.h:1960[m[K,
                 from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/ndarrayobject.h:12[m[K,
                 from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/arrayobject.h:5[m[K,
                 from [01m[K/tmp/tmpi2rk3q9t/src.linux-x86_64-3.11/fortranobject.h:13[m[K,
                 from [01m[K/tmp/tmpi2rk3q9t/src.linux-x86_64-3.11/fortranobject.c:2[m[K:
[01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.h:17:2:[m[K [01;35m[Kwarning: [m[K#warning &quot;Using deprecated NumPy API, disable it with &quot; &quot;#define NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION&quot; [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wcpp-Wcpp]8;;[m[K]
   17 | #[01;35m[Kwarning[m[K &quot;Using deprecated NumPy API, disable it with &quot;       |  [01;35m[K^~~~~~~[m[K
[01m[K/tmp/tmpi2rk3q9t/src.linux-x86_64-3.11/fib1module.c:113:12:[m[K [01;35m[Kwarning: [m[K‚Äò[01m[Kf2py_size[m[K‚Äô defined but not used [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wunused-function-Wunused-function]8;;[m[K]
  113 | static int [01;35m[Kf2py_size[m[K(PyArrayObject* var, ...)
      |            [01;35m[K^~~~~~~~~[m[K
[39mINFO: compiling Fortran sources[0m
[39mINFO: Fortran f77 compiler: /usr/bin/gfortran -Wall -g -ffixed-form -fno-second-underscore -fPIC -O3 -funroll-loops
Fortran f90 compiler: /usr/bin/gfortran -Wall -g -fno-second-underscore -fPIC -O3 -funroll-loops
Fortran fix compiler: /usr/bin/gfortran -Wall -g -ffixed-form -fno-second-underscore -Wall -g -fno-second-underscore -fPIC -O3 -funroll-loops[0m
[39mINFO: compile options: '-I/tmp/tmpi2rk3q9t/src.linux-x86_64-3.11 -I/usr/lib64/python3.11/site-packages/numpy/core/include -I/usr/include/python3.11 -c'[0m
[39mINFO: gfortran:f77: fib1.f[0m
[39mINFO: /usr/bin/gfortran -Wall -g -Wall -g -shared /tmp/tmpi2rk3q9t/tmp/tmpi2rk3q9t/src.linux-x86_64-3.11/fib1module.o /tmp/tmpi2rk3q9t/tmp/tmpi2rk3q9t/src.linux-x86_64-3.11/fortranobject.o /tmp/tmpi2rk3q9t/fib1.o -L/usr/lib/gcc/x86_64-redhat-linux/12 -L/usr/lib/gcc/x86_64-redhat-linux/12 -L/usr/lib64 -lgfortran -o ./fib1.cpython-311-x86_64-linux-gnu.so[0m
Removing build directory /tmp/tmpi2rk3q9t</pre>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ls</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[0m[01;32mfib1.cpython-311-x86_64-linux-gnu.so[0m*
[01;32mfib1.cpython-39-darwin.so[0m*
fib1.f
fib1.pyf
[01;32mfib2.cpython-39-darwin.so[0m*
[01;34mfib2.cpython-39-darwin.so.dSYM[0m/
fib2.pyf
[01;32mfib3.cpython-39-darwin.so[0m*
[01;34mfib3.cpython-39-darwin.so.dSYM[0m/
fib3.f
rotaciones.mod
rotacion.f90
[01;32mrotacion_f.cpython-311-x86_64-linux-gnu.so[0m*
[01;32mrotacion_f.cpython-39-darwin.so[0m*
rotacion.pyf
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">fib1</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fib1</span><span class="o">.</span><span class="n">fib</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">fib(a,[n])

Wrapper for <code class="docutils literal notranslate"><span class="pre">fib</span></code>.

Parameters
----------
a : input rank-1 array('d') with bounds (n)

Other Parameters
----------------
n : input int, optional
    Default: shape(a, 0)</pre>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">fib1</span><span class="o">.</span><span class="n">fib</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="mf">0.</span>  <span class="mf">1.</span>  <span class="mf">1.</span>  <span class="mf">2.</span>  <span class="mf">3.</span>  <span class="mf">5.</span>  <span class="mf">8.</span> <span class="mf">13.</span> <span class="mf">21.</span> <span class="mf">34.</span> <span class="mf">55.</span> <span class="mf">89.</span><span class="p">]</span>
</pre></div>
</div>
<p>Podemos darle adem√°s a la funci√≥n <code class="docutils literal notranslate"><span class="pre">fib</span></code> el argumento opcional <code class="docutils literal notranslate"><span class="pre">n</span></code>.
Solo que debe cumplir la condici√≥n especificada en el archivo <em>fib1.pyf</em></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">fib1</span><span class="o">.</span><span class="n">fib</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---------------------------------------------------------------------------</span>

<span class="n">error</span>                                     <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>

<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
      <span class="mi">1</span> <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="o">----&gt;</span> <span class="mi">2</span> <span class="n">fib1</span><span class="o">.</span><span class="n">fib</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
      <span class="mi">3</span> <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>


<span class="n">error</span><span class="p">:</span> <span class="p">(</span><span class="n">shape</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">n</span><span class="p">)</span> <span class="n">failed</span> <span class="k">for</span> <span class="mi">1</span><span class="n">st</span> <span class="n">keyword</span> <span class="n">n</span><span class="p">:</span> <span class="n">fib</span><span class="p">:</span><span class="n">n</span><span class="o">=</span><span class="mi">8</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">fib1</span><span class="o">.</span><span class="n">fib</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">18</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---------------------------------------------------------------------------</span>

<span class="n">error</span>                                     <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>

<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
      <span class="mi">1</span> <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="o">----&gt;</span> <span class="mi">2</span> <span class="n">fib1</span><span class="o">.</span><span class="n">fib</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">18</span><span class="p">)</span>
      <span class="mi">3</span> <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>


<span class="n">error</span><span class="p">:</span> <span class="p">(</span><span class="n">shape</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">n</span><span class="p">)</span> <span class="n">failed</span> <span class="k">for</span> <span class="mi">1</span><span class="n">st</span> <span class="n">keyword</span> <span class="n">n</span><span class="p">:</span> <span class="n">fib</span><span class="p">:</span><span class="n">n</span><span class="o">=</span><span class="mi">18</span>
</pre></div>
</div>
<p>Esta es una de las caracter√≠sticas de F2PY: hace un chequeo b√°sico de
los argumentos. Hay otro error que no llega a atrapar: Si le pasamos un
array que no es del tipo indicado, falla (sin avisar). √âste claramente
no es el comportamiento deseado:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">fib1</span><span class="o">.</span><span class="n">fib</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>Vamos a modificar el archivo de <em>signature</em> para ense√±arle dos cosas:</p>
<ul class="simple">
<li><p>El entero es un argumento de entrada (requerido)</p></li>
<li><p>El <em>array</em> <code class="docutils literal notranslate"><span class="pre">a</span></code> es un archivo de salida <strong>exclusivamente</strong>. Entonces
no debemos d√°rselo. La parte <code class="docutils literal notranslate"><span class="pre">dimension(n)</span></code> y <code class="docutils literal notranslate"><span class="pre">depend(n)</span></code> indica
que debe crear un vector de ese tama√±o.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!cat fib1.pyf
</pre></div>
</div>
<pre class="literal-block">!    -<em>- f90 -</em>-
! Note: the context of this file is case sensitive.

python module fib1 ! in
    interface  ! in :fib1
        subroutine fib(a,n) ! in :fib1:fib1.f
            real*8 dimension(n) :: a
            integer, optional,check(shape(a, 0) == n),depend(a) :: n=shape(a, 0)
        end subroutine fib
    end interface
end python module fib1

! This file was auto-generated with f2py (version:1.22.0).
! See:
! https://web.archive.org/web/20140822061353/http://cens.ioc.ee/projects/f2py2e</pre>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!cat fib2.pyf
</pre></div>
</div>
<pre class="literal-block">!    -<em>- f90 -</em>-
! Note: the context of this file is case sensitive.

python module fib2
    interface
        subroutine fib(a,n)
            real*8 dimension(n), intent(out), depend(n) :: a
            integer intent(in) :: n
        end subroutine fib
    end interface
end python module fib2

! This file was auto-generated with f2py (version:1.21.2).
! See http://cens.ioc.ee/projects/f2py2e/</pre>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!f2py3  -c fib2.pyf fib1.f &gt; /dev/null
</pre></div>
</div>
<pre class="literal-block">/usr/lib/python3.11/site-packages/setuptools/command/install.py:34: SetuptoolsDeprecationWarning: setup.py install is deprecated. Use build and pip and other standards-based tools.
  warnings.warn(
In file included from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/ndarraytypes.h:1960[m[K,
                 from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/ndarrayobject.h:12[m[K,
                 from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/arrayobject.h:5[m[K,
                 from [01m[K/tmp/<a href="#id11"><span class="problematic" id="id12">tmpfbda0x6_</span></a>/src.linux-x86_64-3.11/fortranobject.h:13[m[K,
                 from [01m[K/tmp/<a href="#id13"><span class="problematic" id="id14">tmpfbda0x6_</span></a>/src.linux-x86_64-3.11/fortranobject.c:2[m[K:
[01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.h:17:2:[m[K [01;35m[Kwarning: [m[K#warning &quot;Using deprecated NumPy API, disable it with &quot; &quot;#define NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION&quot; [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wcpp-Wcpp]8;;[m[K]
   17 | #[01;35m[Kwarning[m[K &quot;Using deprecated NumPy API, disable it with &quot;       |  [01;35m[K^~~~~~~[m[K
In file included from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/ndarraytypes.h:1960[m[K,
                 from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/ndarrayobject.h:12[m[K,
                 from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/arrayobject.h:5[m[K,
                 from [01m[K/tmp/<a href="#id15"><span class="problematic" id="id16">tmpfbda0x6_</span></a>/src.linux-x86_64-3.11/fortranobject.h:13[m[K,
                 from [01m[K/tmp/<a href="#id17"><span class="problematic" id="id18">tmpfbda0x6_</span></a>/src.linux-x86_64-3.11/fib2module.c:20[m[K:
[01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.h:17:2:[m[K [01;35m[Kwarning: [m[K#warning &quot;Using deprecated NumPy API, disable it with &quot; &quot;#define NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION&quot; [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wcpp-Wcpp]8;;[m[K]
   17 | #[01;35m[Kwarning[m[K &quot;Using deprecated NumPy API, disable it with &quot;       |  [01;35m[K^~~~~~~[m[K
[01m[K/tmp/<a href="#id19"><span class="problematic" id="id20">tmpfbda0x6_</span></a>/src.linux-x86_64-3.11/fib2module.c:106:12:[m[K [01;35m[Kwarning: [m[K‚Äò[01m[Kf2py_size[m[K‚Äô defined but not used [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wunused-function-Wunused-function]8;;[m[K]
  106 | static int [01;35m[Kf2py_size[m[K(PyArrayObject* var, ...)
      |            [01;35m[K^~~~~~~~~[m[K</pre>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">fib2</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fib2</span><span class="o">.</span><span class="n">fib</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">a = fib(n)

Wrapper for <code class="docutils literal notranslate"><span class="pre">fib</span></code>.

Parameters
----------
n : input int

Returns
-------
a : rank-1 array('d') with bounds (n)</pre>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fib2</span><span class="o">.</span><span class="n">fib</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">2.</span><span class="p">,</span>  <span class="mf">3.</span><span class="p">,</span>  <span class="mf">5.</span><span class="p">,</span>  <span class="mf">8.</span><span class="p">,</span> <span class="mf">13.</span><span class="p">,</span> <span class="mf">21.</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fib2</span><span class="o">.</span><span class="n">fib</span><span class="p">(</span><span class="mi">14</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>  <span class="mf">0.</span>   <span class="mf">1.</span>   <span class="mf">1.</span>   <span class="mf">2.</span>   <span class="mf">3.</span>   <span class="mf">5.</span>   <span class="mf">8.</span>  <span class="mf">13.</span>  <span class="mf">21.</span>  <span class="mf">34.</span>  <span class="mf">55.</span>  <span class="mf">89.</span> <span class="mf">144.</span> <span class="mf">233.</span><span class="p">]</span>
</pre></div>
</div>
<p>La segunda manera de arreglar este problema, en lugar de modificar el
archivo de <em>signature</em> podr√≠a haber sido modificar el c√≥digo (o hacer
una rutina intermedia). Agregando comentarios de la forma <code class="docutils literal notranslate"><span class="pre">Cf2py</span></code> no
influimos en la compilaci√≥n <code class="docutils literal notranslate"><span class="pre">Fortran</span></code> pero F2PY los reconoce. En este
caso le damos la informaci√≥n sobre la intenci√≥n de los argumentos en el
c√≥digo:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="k">SUBROUTINE </span><span class="n">FIB</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="n">C</span><span class="w"></span>
<span class="n">C</span><span class="w">     </span><span class="n">CALCULATE</span><span class="w"> </span><span class="n">FIRST</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="n">FIBONACCI</span><span class="w"> </span><span class="n">NUMBERS</span><span class="w"></span>
<span class="n">C</span><span class="w"></span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">N</span><span class="w"></span>
<span class="w">      </span><span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="n">Cf2py</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="n">n</span><span class="w"></span>
<span class="n">Cf2py</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"></span>
<span class="n">Cf2py</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"></span>
<span class="w">      </span><span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="n">I</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">A</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0D0</span><span class="w"></span>
<span class="w">         </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="n">I</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">A</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0D0</span><span class="w"></span>
<span class="w">         </span><span class="k">ELSE</span>
<span class="k">            </span><span class="n">A</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">      ENDDO</span>
<span class="k">      END</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!f2py3  -c fib3.f -m fib3 &gt; /dev/null
</pre></div>
</div>
<pre class="literal-block">/usr/lib/python3.11/site-packages/setuptools/command/install.py:34: SetuptoolsDeprecationWarning: setup.py install is deprecated. Use build and pip and other standards-based tools.
  warnings.warn(
In file included from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/ndarraytypes.h:1960[m[K,
                 from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/ndarrayobject.h:12[m[K,
                 from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/arrayobject.h:5[m[K,
                 from [01m[K/tmp/tmp6yhjcrid/src.linux-x86_64-3.11/fortranobject.h:13[m[K,
                 from [01m[K/tmp/tmp6yhjcrid/src.linux-x86_64-3.11/fortranobject.c:2[m[K:
[01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.h:17:2:[m[K [01;35m[Kwarning: [m[K#warning &quot;Using deprecated NumPy API, disable it with &quot; &quot;#define NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION&quot; [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wcpp-Wcpp]8;;[m[K]
   17 | #[01;35m[Kwarning[m[K &quot;Using deprecated NumPy API, disable it with &quot;       |  [01;35m[K^~~~~~~[m[K
In file included from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/ndarraytypes.h:1960[m[K,
                 from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/ndarrayobject.h:12[m[K,
                 from [01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/arrayobject.h:5[m[K,
                 from [01m[K/tmp/tmp6yhjcrid/src.linux-x86_64-3.11/fortranobject.h:13[m[K,
                 from [01m[K/tmp/tmp6yhjcrid/src.linux-x86_64-3.11/fib3module.c:20[m[K:
[01m[K/usr/lib64/python3.11/site-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.h:17:2:[m[K [01;35m[Kwarning: [m[K#warning &quot;Using deprecated NumPy API, disable it with &quot; &quot;#define NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION&quot; [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wcpp-Wcpp]8;;[m[K]
   17 | #[01;35m[Kwarning[m[K &quot;Using deprecated NumPy API, disable it with &quot;       |  [01;35m[K^~~~~~~[m[K
[01m[K/tmp/tmp6yhjcrid/src.linux-x86_64-3.11/fib3module.c:106:12:[m[K [01;35m[Kwarning: [m[K‚Äò[01m[Kf2py_size[m[K‚Äô defined but not used [[01;35m[K]8;;https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#index-Wunused-function-Wunused-function]8;;[m[K]
  106 | static int [01;35m[Kf2py_size[m[K(PyArrayObject* var, ...)
      |            [01;35m[K^~~~~~~~~[m[K</pre>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">fib3</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fib3</span><span class="o">.</span><span class="n">fib</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">a = fib(n)

Wrapper for <code class="docutils literal notranslate"><span class="pre">fib</span></code>.

Parameters
----------
n : input int

Returns
-------
a : rank-1 array('d') with bounds (n)</pre>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fib2</span><span class="o">.</span><span class="n">fib</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">a = fib(n)

Wrapper for <code class="docutils literal notranslate"><span class="pre">fib</span></code>.

Parameters
----------
n : input int

Returns
-------
a : rank-1 array('d') with bounds (n)</pre>
<p>como vemos, son exactamente iguales.</p>
</section>
<section id="f2py-para-codigo-en-c">
<h3>F2PY para c√≥digo en C<a class="headerlink" href="#f2py-para-codigo-en-c" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Es posible usar F2PY para c√≥digo escrito en C, pero en ese caso debemos
escribir el <em>signature file</em> a mano.</p>
<p>Para c√≥digo en C es conveniente utilizar <strong>Cython</strong>. Cython es un
lenguaje de programaci√≥n pensado para hacer m√°s f√°cil escribir
extensiones a Python en C. Uno escribe el c√≥digo en Cython, y luego es
traducido a C, con optimizaciones.</p>
<p><strong>Cython</strong> tambi√©n puede utilizarse con Fortran de una manera similar a
c√≥mo se usa con C. Para m√°s informaci√≥n ver la <a class="reference external" href="http://docs.cython.org/en/latest/index.html">documentaci√≥n
oficial</a></p>
</section>
</section>
<section id="interfaces-con-otros-lenguajes-c">
<h2>Interfaces con otros lenguajes: C<a class="headerlink" href="#interfaces-con-otros-lenguajes-c" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>Existen varias formas de utilizar bibliotecas o c√≥digos hechos en C
desde Python. Nosotros veremos el uso de <code class="docutils literal notranslate"><span class="pre">Ctypes</span></code>, sin embargo existen
otras alternativas como <a class="reference external" href="https://cython.org/">Cython</a>,
<a class="reference external" href="https://cffi.readthedocs.io/en/latest/">CFFI</a>,
<a class="reference external" href="https://pybind11.readthedocs.io/en/stable/">pybind11</a> y
<a class="reference external" href="https://www.boost.org/doc/libs/1_70_0/libs/python/doc/html/index.html">Boost.Python</a>.</p>
<p>Seguimos con el ejemplo de la rotaci√≥n de vectores. Por completitud,
agregamos la funciones en Python para comparar</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pwd</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;/home/fiol/Clases/IntPython/clases-python/clases&#39;</span>
</pre></div>
</div>
<p>Si ya tenemos un m√≥dulo donde est√°n programadas las funciones necesarias</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">matrix_rotation</span><span class="p">(</span><span class="n">angles</span><span class="p">):</span>
  <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">cz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
  <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
  <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">cz</span> <span class="o">-</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">sz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">cz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">sy</span>

  <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sx</span> <span class="o">*</span> <span class="n">cz</span> <span class="o">-</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">sz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sx</span> <span class="o">*</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">cz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">sy</span>

  <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sy</span> <span class="o">*</span> <span class="n">sz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sy</span> <span class="o">*</span> <span class="n">cz</span>
  <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cy</span>
  <span class="k">return</span> <span class="n">R</span>


<span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">matrix_rotation</span><span class="p">(</span><span class="n">angles</span><span class="p">),</span> <span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<span class="c1"># √Ångulos de Euler</span>
<span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># Definimos N vectores tridimensionales</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># y= rotp.rotate(angle, v)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mf">0.58546738</span> <span class="mf">0.89120506</span> <span class="mf">0.36725088</span><span class="p">]</span>
<span class="p">[[</span> <span class="mf">0.57382166</span>  <span class="mf">0.36547642</span>  <span class="mf">0.42691154</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">1.20276102</span>  <span class="mf">0.38198882</span>  <span class="mf">0.35784136</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.3032189</span>   <span class="mf">0.17018825</span> <span class="o">-</span><span class="mf">0.15835914</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.69480807</span>  <span class="mf">0.1054089</span>  <span class="o">-</span><span class="mf">0.15883335</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">1.36627837</span>  <span class="mf">0.1736621</span>   <span class="mf">0.17036402</span><span class="p">]]</span>
</pre></div>
</div>
<p>Veamos c√≥mo trabajar si tenemos el c√≥digo para realizar las rotaciones
en C.</p>
<section id="id1">
<h3>Primer ejemplo: Nuestro c√≥digo<a class="headerlink" href="#id1" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>El c√≥digo en C que tenemos es:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kt">float</span><span class="w"> </span><span class="n">m</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">m3x3</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kt">float</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">v3</span><span class="p">;</span><span class="w"></span>

<span class="p">...</span><span class="w"></span>

<span class="kt">float</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rotate</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">angles</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">*</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="p">){</span><span class="w"></span>

<span class="w">        </span><span class="n">m3x3</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrix_rotation</span><span class="p">(</span><span class="n">angles</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">N</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">v3</span><span class="w"> </span><span class="n">p</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">y</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">            </span><span class="c1">// p = &amp;y[i*3];</span>
<span class="w">            </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matmul3</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="o">&amp;</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="p">]);</span><span class="w"></span>
<span class="w">            </span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
<span class="w">            </span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
<span class="w">            </span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w"></span>
<span class="w">            </span><span class="c1">// printf(&quot;%6.3f %6.3f %6.3f \n&quot;,y[i*3+0],y[i*3+1],y[i*3+2]);</span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"></span>


<span class="w">  </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">../</span><span class="n">scripts</span><span class="o">/</span><span class="n">interfacing_C</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">fiol</span><span class="o">/</span><span class="n">Clases</span><span class="o">/</span><span class="n">IntPython</span><span class="o">/</span><span class="n">clases</span><span class="o">-</span><span class="n">python</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">interfacing_C</span>
</pre></div>
</div>
</section>
<section id="ctypes">
<h3>CTypes<a class="headerlink" href="#ctypes" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>No vamos a usar directamente <code class="docutils literal notranslate"><span class="pre">Ctypes</span></code>, sino a trav√©s de <code class="docutils literal notranslate"><span class="pre">NumPy</span></code>, que
provee algunas funciones convenientes para acceder al c√≥digo C.</p>
<p>El primer paso es compilar nuestro c√≥digo y generar una biblioteca:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ gcc -fpic -Wall -shared rotacion.c -o librotacion.so
</pre></div>
</div>
<p>Si uno trabaja en Windows con <a class="reference external" href="https://visualstudio.microsoft.com/es/vs/features/cplusplus/">MS
C++</a>,
generar√° una dll</p>
<div class="highlight-cmd notranslate"><div class="highlight"><pre><span></span>cl.exe -c rotacion.c
link.exe /DLL /OUT:rotacion.dll
</pre></div>
</div>
<p>Si en cambio <a class="reference external" href="https://www.msys2.org/">instal√≥ gcc</a>, puede usar el
comando previo.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!gcc -fpic -Wall -shared rotacion.c -o librotacion.so
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!ls
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">librotacion</span><span class="o">.</span><span class="n">so</span>      <span class="n">rotacion</span><span class="o">.</span><span class="n">c</span>
</pre></div>
</div>
<p>En segundo lugar, importamos el m√≥dulo <code class="docutils literal notranslate"><span class="pre">ctypeslib</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy.ctypeslib</span> <span class="k">as</span> <span class="nn">ctl</span>
</pre></div>
</div>
<p>Este m√≥dulo nos provee de la funci√≥n <code class="docutils literal notranslate"><span class="pre">load_library</span></code> para importar la
biblioteca</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">ctl</span><span class="o">.</span><span class="n">load_library</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">Help on function load_library in module numpy.ctypeslib:

load_library(libname, loader_path)
    It is possible to load a library using

    &gt;&gt;&gt; lib = ctypes.cdll[&lt;full_path_name&gt;] # doctest: +SKIP

    But there are cross-platform considerations, such as library file extensions,
    plus the fact Windows will just load the first library it finds with that name.
    NumPy supplies the load_library function as a convenience.

    .. versionchanged:: 1.20.0
        Allow libname and loader_path to take any
        <span class="xref std std-term">python:path-like object</span>.

    Parameters
    ----------
    libname : path-like
        Name of the library, which can have 'lib' as a prefix,
        but without an extension.
    loader_path : path-like
        Where the library can be found.

    Returns
    -------
    ctypes.cdll[libpath] : library object
       A ctypes library object

    Raises
    ------
    OSError
        If there is no library with the expected extension, or the
        library is defective and cannot be loaded.</pre>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rotc</span> <span class="o">=</span> <span class="n">ctl</span><span class="o">.</span><span class="n">load_library</span><span class="p">(</span><span class="s1">&#39;librotacion.so&#39;</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Una vez cargada la biblioteca, tenemos que definir adecuadamente c√≥mo
pasar los argumentos a la funci√≥n <code class="docutils literal notranslate"><span class="pre">rotate</span></code> de C:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rotate</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">angles</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">*</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>Para eso se utiliza la funci√≥n <code class="docutils literal notranslate"><span class="pre">argtypes</span></code> que recibe una lista de
tipos. Notemos que los dos primeros argumentos son arreglos de C (o sea,
punteros), mientras que el √∫ltimo es un entero.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">npflags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;C_CONTIGUOUS&#39;</span><span class="p">]</span>   <span class="c1"># Require a C contiguous array in memory</span>

<span class="n">float_1d_type</span> <span class="o">=</span> <span class="n">ctl</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">npflags</span><span class="p">)</span> <span class="c1"># Puntero a float, 1D</span>
<span class="n">float_2d_type</span> <span class="o">=</span> <span class="n">ctl</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">npflags</span><span class="p">)</span> <span class="c1"># Puntero a float, 2D</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">float_1d_type</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_ctypes</span><span class="o">.</span><span class="n">PyCSimpleType</span>
</pre></div>
</div>
<p>Con estos tipos de datos, defino los tipos de argumentos, que son tres
en total. El √∫ltimo es un dato de tipo entero, para lo cual se usa
directamente <code class="docutils literal notranslate"><span class="pre">c_intp</span></code>. Para definir el tipo de argumentos de entrada a
la funci√≥n <code class="docutils literal notranslate"><span class="pre">rotc.rotate</span></code> usamos el m√©todo <code class="docutils literal notranslate"><span class="pre">argtypes</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rotc</span><span class="o">.</span><span class="n">rotate</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span>  <span class="p">[</span><span class="n">float_1d_type</span><span class="p">,</span> <span class="n">float_2d_type</span><span class="p">,</span> <span class="n">ctl</span><span class="o">.</span><span class="n">c_intp</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">rotc</span><span class="o">.</span><span class="n">rotate</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Help</span> <span class="n">on</span> <span class="n">_FuncPtr</span> <span class="ow">in</span> <span class="n">module</span> <span class="n">ctypes</span> <span class="nb">object</span><span class="p">:</span>

<span class="n">rotate</span> <span class="o">=</span> <span class="k">class</span> <span class="nc">_FuncPtr</span><span class="p">(</span><span class="n">_ctypes</span><span class="o">.</span><span class="n">CFuncPtr</span><span class="p">)</span>
 <span class="o">|</span>  <span class="n">Method</span> <span class="n">resolution</span> <span class="n">order</span><span class="p">:</span>
 <span class="o">|</span>      <span class="n">_FuncPtr</span>
 <span class="o">|</span>      <span class="n">_ctypes</span><span class="o">.</span><span class="n">CFuncPtr</span>
 <span class="o">|</span>      <span class="n">_ctypes</span><span class="o">.</span><span class="n">_CData</span>
 <span class="o">|</span>      <span class="n">builtins</span><span class="o">.</span><span class="n">object</span>
 <span class="o">|</span>
 <span class="o">|</span>  <span class="n">Data</span> <span class="n">descriptors</span> <span class="n">defined</span> <span class="n">here</span><span class="p">:</span>
 <span class="o">|</span>
 <span class="o">|</span>  <span class="vm">__dict__</span>
 <span class="o">|</span>      <span class="n">dictionary</span> <span class="k">for</span> <span class="n">instance</span> <span class="n">variables</span> <span class="p">(</span><span class="k">if</span> <span class="n">defined</span><span class="p">)</span>
 <span class="o">|</span>
 <span class="o">|</span>  <span class="vm">__weakref__</span>
 <span class="o">|</span>      <span class="nb">list</span> <span class="n">of</span> <span class="n">weak</span> <span class="n">references</span> <span class="n">to</span> <span class="n">the</span> <span class="nb">object</span> <span class="p">(</span><span class="k">if</span> <span class="n">defined</span><span class="p">)</span>
 <span class="o">|</span>
 <span class="o">|</span>  <span class="o">----------------------------------------------------------------------</span>
 <span class="o">|</span>  <span class="n">Methods</span> <span class="n">inherited</span> <span class="kn">from</span> <span class="nn">_ctypes.CFuncPtr</span><span class="p">:</span>
 <span class="o">|</span>
 <span class="o">|</span>  <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span>
 <span class="o">|</span>      <span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span> <span class="k">else</span> <span class="kc">False</span>
 <span class="o">|</span>
 <span class="o">|</span>  <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
 <span class="o">|</span>      <span class="n">Call</span> <span class="bp">self</span> <span class="k">as</span> <span class="n">a</span> <span class="n">function</span><span class="o">.</span>
 <span class="o">|</span>
 <span class="o">|</span>  <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span>
 <span class="o">|</span>      <span class="n">Return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span>
 <span class="o">|</span>
 <span class="o">|</span>  <span class="o">----------------------------------------------------------------------</span>
 <span class="o">|</span>  <span class="n">Static</span> <span class="n">methods</span> <span class="n">inherited</span> <span class="kn">from</span> <span class="nn">_ctypes.CFuncPtr</span><span class="p">:</span>
 <span class="o">|</span>
 <span class="o">|</span>  <span class="fm">__new__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">_ctypes.PyCFuncPtrType</span>
 <span class="o">|</span>      <span class="n">Create</span> <span class="ow">and</span> <span class="k">return</span> <span class="n">a</span> <span class="n">new</span> <span class="nb">object</span><span class="o">.</span>  <span class="n">See</span> <span class="n">help</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span> <span class="k">for</span> <span class="n">accurate</span> <span class="n">signature</span><span class="o">.</span>
 <span class="o">|</span>
 <span class="o">|</span>  <span class="o">----------------------------------------------------------------------</span>
 <span class="o">|</span>  <span class="n">Data</span> <span class="n">descriptors</span> <span class="n">inherited</span> <span class="kn">from</span> <span class="nn">_ctypes.CFuncPtr</span><span class="p">:</span>
 <span class="o">|</span>
 <span class="o">|</span>  <span class="n">argtypes</span>
 <span class="o">|</span>      <span class="n">specify</span> <span class="n">the</span> <span class="n">argument</span> <span class="n">types</span>
 <span class="o">|</span>
 <span class="o">|</span>  <span class="n">errcheck</span>
 <span class="o">|</span>      <span class="n">a</span> <span class="n">function</span> <span class="n">to</span> <span class="n">check</span> <span class="k">for</span> <span class="n">errors</span>
 <span class="o">|</span>
 <span class="o">|</span>  <span class="n">restype</span>
 <span class="o">|</span>      <span class="n">specify</span> <span class="n">the</span> <span class="n">result</span> <span class="nb">type</span>
 <span class="o">|</span>
 <span class="o">|</span>  <span class="o">----------------------------------------------------------------------</span>
 <span class="o">|</span>  <span class="n">Methods</span> <span class="n">inherited</span> <span class="kn">from</span> <span class="nn">_ctypes._CData</span><span class="p">:</span>
 <span class="o">|</span>
 <span class="o">|</span>  <span class="n">__ctypes_from_outparam__</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
 <span class="o">|</span>
 <span class="o">|</span>  <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span>
 <span class="o">|</span>      <span class="n">Return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span>
 <span class="o">|</span>
 <span class="o">|</span>  <span class="n">__reduce__</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
 <span class="o">|</span>      <span class="n">Helper</span> <span class="k">for</span> <span class="n">pickle</span><span class="o">.</span>
 <span class="o">|</span>
 <span class="o">|</span>  <span class="n">__setstate__</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>Hagamos un ejemplo sencillo con N=2</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">2</span>
<span class="c1"># √Ångulos de Euler</span>
<span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="c1"># Definimos N vectores tridimensionales</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</pre></div>
</div>
<p>Las funciones que dispongo en C reciben tipos <code class="docutils literal notranslate"><span class="pre">float</span></code>, es decir que me
tengo que asegurar esto a trav√©s del m√©todo <code class="docutils literal notranslate"><span class="pre">astype</span></code>.</p>
<p>Ahora tenemos que definir el tipo de dato de salida, que retorna C a
trav√©s de un puntero a float, <code class="docutils literal notranslate"><span class="pre">float*</span></code>. Para esto usamos el m√©todo
<code class="docutils literal notranslate"><span class="pre">restype</span></code>. Como a priori no s√© qu√© tipo de rango tiene mi arreglo de
salida, tengo que definirlo expl√≠citamente.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rotc</span><span class="o">.</span><span class="n">rotate</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctl</span><span class="o">.</span><span class="n">ndpointer</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
<p>Hay que tener precauci√≥n con el manejo de arreglos, que es muy distinto
en C y Python. En Python son objetos, de los cuales yo puedo tener
distintas vistas, slices, etc. Hay que recordar que en principio estas
son formas de acceder al mismo objeto, pero no se pueden traducir
directamente a C, que necesita un arreglo contiguo de datos.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">vt</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vt</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="mf">1.</span> <span class="mf">0.</span><span class="p">]</span>
 <span class="p">[</span><span class="mf">0.</span> <span class="mf">1.</span><span class="p">]</span>
 <span class="p">[</span><span class="mf">0.</span> <span class="mf">0.</span><span class="p">]]</span>
<span class="p">[[</span><span class="mf">1.</span> <span class="mf">0.</span> <span class="mf">0.</span><span class="p">]</span>
 <span class="p">[</span><span class="mf">0.</span> <span class="mf">1.</span> <span class="mf">0.</span><span class="p">]]</span>
<span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Veamos, v es un arreglo de 3 filas y 2 columnas, que contiene <em>dos</em>
vectores de tres dimensiones que se desean rotar, organizados como
columnas. Esto <em>no</em> es lo que necesita mi arreglo en C, que es tiene los
vectores organizados contiguamente en un solo arreglo unidimensional.
Entonces, tengo que transformarlo. Para eso usamos el <code class="docutils literal notranslate"><span class="pre">.T</span></code>. Ojo que
adem√°s, hay que crear un objeto nuevo con <code class="docutils literal notranslate"><span class="pre">copy()</span></code>, sino es una vista
del mismo objeto <code class="docutils literal notranslate"><span class="pre">v</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">angle90</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">angle90</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mf">0.</span>        <span class="mf">0.</span>        <span class="mf">1.5707964</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">yf</span> <span class="o">=</span> <span class="n">rotc</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">angle90</span><span class="p">,</span>
                      <span class="n">vt</span><span class="p">,</span>
                      <span class="n">N</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">angle90</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># suppress controla c√≥mo print va a escribir los n√∫meros de punto flotante.</span>

<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">yf</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">yf</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="o">-</span><span class="mf">0.00000004</span>  <span class="mf">1.</span>        <span class="p">]</span>
 <span class="p">[</span><span class="o">-</span><span class="mf">1.</span>         <span class="o">-</span><span class="mf">0.00000004</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.</span>          <span class="mf">0.</span>        <span class="p">]]</span>
<span class="p">[[</span><span class="o">-</span><span class="mf">0.00000004</span>  <span class="mf">1.</span>        <span class="p">]</span>
 <span class="p">[</span><span class="o">-</span><span class="mf">1.</span>         <span class="o">-</span><span class="mf">0.00000004</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.</span>          <span class="mf">0.</span>        <span class="p">]]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kc">True</span>
</pre></div>
</div>
</section>
</section>
<section id="interfaces-con-clases-en-c">
<h2>Interfaces con clases en C++<a class="headerlink" href="#interfaces-con-clases-en-c" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>El ejemplo original est√°
<a class="reference external" href="https://stackoverflow.com/questions/602580/how-can-i-use-c-class-in-python">ac√°</a>
que sigue <a class="reference external" href="https://www.auctoris.co.uk/2017/04/29/calling-c-classes-from-python-with-ctypes/">este
ejemplo</a>:</p>
<p>El c√≥digo en C++ que tenemos es:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Test</span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="k">private</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"></span>
<span class="w">     </span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="n">Test</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">){</span><span class="w"></span>
<span class="w">            </span><span class="n">n</span><span class="o">=</span><span class="n">k</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">setInt</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">){</span><span class="w"></span>
<span class="w">            </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">getInt</span><span class="p">(){</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">../</span><span class="n">scripts</span><span class="o">/</span><span class="n">interfacing_Cpp</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">fiol</span><span class="o">/</span><span class="n">Clases</span><span class="o">/</span><span class="n">IntPython</span><span class="o">/</span><span class="n">clases</span><span class="o">-</span><span class="n">python</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">interfacing_Cpp</span>
</pre></div>
</div>
<p>La implementaci√≥n de Python que estamos usando est√° escrita en C, de
modo tal que tenemos que exportar las funciones de la clase <code class="docutils literal notranslate"><span class="pre">Test</span></code> en
C++ en el c√≥digo fuente de la siguiente manera:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// include below each method you want to make visible outside</span>
<span class="w">    </span><span class="n">Test</span><span class="o">*</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Test</span><span class="p">(</span><span class="n">k</span><span class="p">);}</span><span class="w"></span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">setInt</span><span class="p">(</span><span class="n">Test</span><span class="w"> </span><span class="o">*</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">self</span><span class="o">-&gt;</span><span class="n">setInt</span><span class="p">(</span><span class="n">k</span><span class="p">);}</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">getInt</span><span class="p">(</span><span class="n">Test</span><span class="w"> </span><span class="o">*</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="o">-&gt;</span><span class="n">getInt</span><span class="p">();}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Add the declaration &#39;__declspec(dllexport)&#39; before each function in Windows</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>La declaraci√≥n <code class="docutils literal notranslate"><span class="pre">extern</span> <span class="pre">&quot;C&quot;</span></code> indican al compilador de C++ que genere
c√≥digo compatible con C de todas las funciones inclu√≠das en el bloque.</p>
<section id="id10">
<h3>CTypes<a class="headerlink" href="#id10" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Vamos ahora a usar directamente <code class="docutils literal notranslate"><span class="pre">Ctypes</span></code>. Como antes, el primer paso
es compilar nuestro c√≥digo y generar una biblioteca:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ g++ -fpic -shared test.cpp -o libtest.so
</pre></div>
</div>
<p>Si uno trabaja en Windows, generar√° una dll</p>
<div class="highlight-cmd notranslate"><div class="highlight"><pre><span></span>cl.exe -c test.cpp
link.exe /DLL /OUT:test.dll
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span># !gcc -fpic -Wall -shared rotacion.c -o librotacion.so
!g++ -fpic -shared test.cpp -o libtest.so
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!ls
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">libtest</span><span class="o">.</span><span class="n">so</span>  <span class="n">test</span><span class="o">.</span><span class="n">cpp</span>
</pre></div>
</div>
<p>En segundo lugar, importamos el m√≥dulo <code class="docutils literal notranslate"><span class="pre">ctypes</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ctypes</span>
</pre></div>
</div>
<p>Este m√≥dulo nos provee de la funci√≥n <code class="docutils literal notranslate"><span class="pre">CDLL</span></code> para importar la
biblioteca</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lib</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="s1">&#39;./libtest.so&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Ahora vamos a crear una clase en Python equivalente a la que ten√≠amos en
C++. Al igual que en el caso de C, tenemos que establecer los tipos de
datos de entrada (via el m√©todo <code class="docutils literal notranslate"><span class="pre">argtypes</span></code>) y salida (v√≠a el m√©todo
<code class="docutils literal notranslate"><span class="pre">restype</span></code>) para <em>cada funci√≥n de la clase</em>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Test</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="c1"># Declare input and output types for each method you intend to use</span>
        <span class="n">lib</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">]</span>
        <span class="n">lib</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span>

        <span class="n">lib</span><span class="o">.</span><span class="n">setInt</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">]</span>
        <span class="n">lib</span><span class="o">.</span><span class="n">setInt</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span>

        <span class="n">lib</span><span class="o">.</span><span class="n">getInt</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">]</span>
        <span class="n">lib</span><span class="o">.</span><span class="n">getInt</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span>

        <span class="c1"># use the C++ constructor to build the instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setInt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">lib</span><span class="o">.</span><span class="n">setInt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getInt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lib</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">T1</span> <span class="o">=</span> <span class="n">Test</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">T1</span><span class="o">.</span><span class="n">getInt</span><span class="p">())</span>
<span class="n">T1</span><span class="o">.</span><span class="n">setInt</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">T1</span><span class="o">.</span><span class="n">getInt</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">12</span>
<span class="mi">32</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">T1</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pie de p√°gina">
        <a href="clase_14.html" class="btn btn-neutral float-left" title="Clase 14: Animaciones e interactividad" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
        <a href="ejercicios.html" class="btn btn-neutral float-right" title="Ejercicios" accesskey="n" rel="next">Siguiente <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Derechos de autor IB - 2023, Juan Fiol.</p>
  </div>

  Compilado con <a href="https://www.sphinx-doc.org/">Sphinx</a> usando un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">tema</a>
    proporcionado por <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>